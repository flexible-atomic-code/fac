#############################################################
## This is the top-level Makefile.in.
## Run configure to create the Makefile.
#############################################################

@SET_MAKE@

SHELL = /bin/sh

PYTHON = @PYTHON@

CC = @CC@

RANLIB = @RANLIB@

TOPDIR = @TOPDIR@

CFLAGS = @CPPFLAGS@ @CFLAGS@

LIBS = @LDFLAGS@ @LIBS@ @FLIBS@

all: lib sfac

lib:
	cd blas;     make
	cd lapack;   make
	cd coul;     make
	cd ode;      make
	cd toms;     make
	cd mpfun;    make
	cd minpack;  make
	cd quadpack; make
	cd ionis;    make
	cd modqed;   make
	cd faclib;   make
	${RANLIB} libfac.a

sfac:	lib
	cd sfac; make

pfac:   lib
	${PYTHON} setup.py build --force -ccompiler="${CC}" -extracomp="${CFLAGS}" -extralink="${LIBS}"
mpy:
	${PYTHON} setup.py build -mpy -extracomp="${CFLAGS}" -extralink="${LIBS}"

doc:
	cd doc; make

test:
	cd tests; make; make test

check : subdirs
	@set -e; for i in $(SUBDIRS); do (cd $$i; $(MAKE) check) || exit 1; done

demo:
	cd demo; make

install:
	cd sfac; make install

install-pfac:
	${PYTHON} setup.py install -ccompiler="${CC}" 

install-mpy:
	cd python; make install

clean:
	rm -f *.so *.a *.o *~
	rm -rf build
	cd lapack;   make clean
	cd blas;     make clean
	cd coul;     make clean
	cd ode;      make clean
	cd toms;     make clean
	cd mpfun;    make clean
	cd minpack;  make clean
	cd quadpack; make clean
	cd ionis;    make clean
	cd modqed;   make clean
	cd faclib;   make clean
	cd sfac;     make clean

cleanfac:
	cd faclib;   make clean
	cd python;   make clean
	cd sfac;     make clean
